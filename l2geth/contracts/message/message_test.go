package message

import (
	"fmt"
	"log"
	"testing"

	"github.com/mantlenetworkio/mantle/l2geth/common/hexutil"
)

func TestUnpacket(t *testing.T) {
	hexData := "0xcbd4ece9000000000000000000000000deaddeaddeaddeaddeaddeaddeaddeaddead2222000000000000000000000000d9e2f450525079e1e29fb23bc7caca6f61f8fd4a0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000024f523f40d00000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000"
	data := &Data{}
	decodedData, err := hexutil.Decode(hexData)
	if err != nil {
		log.Fatal(err)
	}
	if err := data.UnPackData(decodedData); err != nil {
		log.Fatal(err)
	}

	hexData1 := "0xcbd4ece9000000000000000000000000420000000000000000000000000000000000002000000000000000000000000088ec574e2ef0ecf9043373139099f7e535f94dbc000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000077fa00000000000000000000000000000000000000000000000000000000000001840fae75d9000000000000000000000000000000000000000000000000000000000001752900000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000063e3a9a8000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000070000000000000000000000009a75006afc2879dc7c5ce8c69c456172f58096500000000000000000000000009a7517454f83f7d8b049ed834c3307ddf54bab4b0000000000000000000000009a7525927dde32738d478c63cf314511ccd2545f0000000000000000000000009a753580abc3710af53c7f28644e71140bffa7160000000000000000000000009a7540bf80cc51727fafafe1d63a2ae2802ee4d30000000000000000000000009a75531f6ea8a187ec6e2e3611b88fd219571eab0000000000000000000000009a756046fc2e10c289e1ac234e105973f20725ea00000000000000000000000000000000000000000000000000000000"
	data1 := &Data{}
	decodedData1, err := hexutil.Decode(hexData1)
	if err != nil {
		log.Fatal(err)
	}
	if err := data1.UnPackData(decodedData1); err != nil {
		log.Fatal(err)
	}
	fmt.Println("data1.Message:", hexutil.Encode(data1.Message))

	hexData2 := "0xcbd4ece9000000000000000000000000420000000000000000000000000000000000002000000000000000000000000088ec574e2ef0ecf9043373139099f7e535f94dbc000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000077fa00000000000000000000000000000000000000000000000000000000000001840fae75d9000000000000000000000000000000000000000000000000000000000001752900000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000063e3a9b4000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000070000000000000000000000009a75006afc2879dc7c5ce8c69c456172f58096500000000000000000000000009a7517454f83f7d8b049ed834c3307ddf54bab4b0000000000000000000000009a7525927dde32738d478c63cf314511ccd2545f0000000000000000000000009a753580abc3710af53c7f28644e71140bffa7160000000000000000000000009a7540bf80cc51727fafafe1d63a2ae2802ee4d30000000000000000000000009a75531f6ea8a187ec6e2e3611b88fd219571eab0000000000000000000000009a756046fc2e10c289e1ac234e105973f20725ea00000000000000000000000000000000000000000000000000000000"
	data2 := &Data{}
	decodedData2, err := hexutil.Decode(hexData2)
	if err != nil {
		log.Fatal(err)
	}
	if err := data2.UnPackData(decodedData2); err != nil {
		log.Fatal(err)
	}
	fmt.Println("data2.Message:", hexutil.Encode(data2.Message))
}

func TestRollbackData_UnPackData(t *testing.T) {
	hexData := "0xf523f40d000000000000000000000000000000000000000000000000000000000000000e"
	data := &RollbackData{}
	decodedData, err := hexutil.Decode(hexData)
	if err != nil {
		log.Fatal(err)
	}
	if err := data.UnPackData(decodedData); err != nil {
		log.Fatal(err)
	}
}
